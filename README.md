## CloudKitchens Code Challenge

### Kitchen Unit System

The Kitchen Unit system was created using the actor model (implemented with the Akka toolkit). Therefore, it follows the principles of reactive systems, which means this system is based on the following principles:

*	Responsive
*	Resilient
*	Elastic
*	Message-Driven

This means that the communication among the components are not via regular method calls but rather messages (that can be manifested either as commands or events). This brings some very interesting properties such as:

*	Loose coupling
*	Isolation and location transparency
*	Non-blocking communication

The system is composed of four main actors:

*	KitchenUnit
*	ShelveManager
*	Order
*	CourierDispatcher

The **KitchenUnit** actor is the root actor and its main responsibilities are:

*	Receive orders from a reactive stream (more on this later)
*	Create and supervise the child order actors that will be controlling the individual order lifecycle
*	Create and dispatch Courier actors to placed orders
*	Create and supervise the ShelveManager which is going to be responsible to control the shelve operations among the available shelves.
*	Shutdown the whole kitchen unit system in a graceful manner (making sure no orders are left behind) when the upstream of orders is completed.

The **ShelveManager** actor is mainly responsible to control the access and operations to the available shelves in the kitchen unit system. Below are some of the details of its responsibilities:

*	Make sure the cooked orders are placed on the most suitable shelf
*	Move orders around when needed to make room for new incoming orders
*	Control the expiration of every order given their shelf life, decay and the type of the shelf they are stores.
*	Remove orders from the shelf when requested (e.g. when they are picked up by the courier)

The **Order** actor is responsible to manage the lifecycle of individual orders, so they are only kept around whilst the order is in progress. It maintains a communication with the ShelveManager to retrieve the packaged order on courier arrival and it is informed when a order get wasted so it can coordinate the cancel of the pickup with the courier.
The CourierDispatcher actor is responsible to pickup and deliver of the assigned orders. 


### Reactive Streams

The flow of orders to the system was implemented using reactive streams (Akka Streams implementation). One important characteristic of reactive streams that worth mentioning is the non-blocking back pressure mechanism. Which means that doesn’t matter how big the source of orders is, if it is hundreds, thousands, millions of orders it would flow the orders smoothly throughout the system, respecting the throttling rate (configurable).
The stream source is a file containing a collection of orders follow by a series of transformation flows that is followed by the KitchenUnit actor acting as the sink of the reactive stream.
It is important to mention that the throttle is the only place in the whole stream where back pressure signal is active. By design I’ve decided to let the sink (KitchenUnit) to not signal back pressure to the upstream allowing it to receive as many concurrent order requests as allowed by the throttle control.


### Prerequisites

* JDK 11

###Running The Unit Tests

in unix-based:
```
./gradlew test
```

in windows-based:

```
./gradlew.bat test
```

You can run it with *./gradlew test -i* so you can check the results right in the console.
If you prefer you can access the testing report generated by gradle in *.build/reports/tests/test/index.html*

###Running The Kitchen Unit

in unix-based:
```
./gradlew run
```

in windows-based:

```
./gradlew.bat run
```

#####Config

You can run with the default settings and use the provided sample orders.json file. 
However, you if you prefer you can tweak the *kitchen-unit.conf* configuration file to change:

- Order ingestion rate (per second)
- Courier pick up range time
- Shelves Capacity

You can also change the orders.json content or simply pointing the configuration to another json file.

#####Logs

You can follow the logs on the console or you can find it at *kitchen-unit.log* file. 


## Built With

* [Gradle](https://gradle.org/) - Dependency Management

## Authors

* **Marcelo Busatta** 